import { useEffect, useState } from "react";
import { Icon } from "@iconify/react/dist/iconify.js";
import { Link, useNavigate } from "react-router-dom";
import { useParams } from "react-router-dom";

import { AuthUser } from "~/services/auth";

import { Button } from "~/components";
import Loader from "~/components/Loader/loader";
import { useOnAuth } from "~/hooks";

// TODO: activation account
const Activation = () => {
  const [isLoading, setIsLoading] = useState(true);
  const { token } = useParams<{ token: string }>();
  const navigate = useNavigate();
  const { handleSignin } = useOnAuth();

  const setActivationToken = async (authToken: string) => {
    try {
      // const response = await ActivationService.onActive(authToken);
      setIsLoading(false);
      // handleSignin(response);
    } catch (error: any) {
      navigate(-1);
      console.error(error);
    }
  };

  useEffect(() => {
    if (token) {
      const authToken = token.split("$").join(".");
      setActivationToken(authToken);
      return;
    }
  }, [token]);

  return (
    <>
      {isLoading ? (
        <div>
          <Loader />
        </div>
      ) : (
        <div className="flex flex-col items-center justify-center px-6">
          <Icon
            icon="ion:checkmark-done-circle-outline"
            width={64}
            className="text-green-500"
          />
          <h2 className="my-2 text-center">
            ¡Hás activado tu cuenta con Exito!
          </h2>
          <p className="text-center text-sm">
            Felicidades, tu cuenta ha sido activada con éxito, ahora puedes
            iniciar sesión
          </p>
          <Link to="/login">
            <Button className="mt-6">
              Continuar
              <Icon icon="basil:arrow-right-outline" width={26} />
            </Button>
          </Link>
        </div>
      )}
    </>
  );
};

export default Activation;
